# vi: ft=vimwiki

* [X] Autocomplete \n with loaded named queries
* [X] Reload named queries without restarting (\nr) - v4.3.14
* [X] autocomplete set role command with roles. - v4.3.15

* [X] ssh_tunnel.py: Pass `host_pkey_directories=[]` to SSHTunnelForwarder to prevent
      sshtunnel from scanning ~/.ssh/ for key files (id_ecdsa, id_rsa, etc.) and prompting
      for passphrases. Keep `allow_agent=True` so it uses keys loaded in ssh-agent. - v4.3.18
* [ ] Add coverage.
* [X] Fix mypy errors (134 total). Main issues:
      - pgexecute.py: ~30 errors (Optional/None checks)
      - main.py: 25 errors (Optional checks, namedtuple naming)
      - packages/sqlcompletion.py: ~25 errors (missing call args)
      - pgcompleter.py: 10 errors (type annotations)
      - ssh_tunnel.py: 7 errors (Optional checks)
      Run: .venv/bin/python -m mypy
* [ ] Refactor to sqlcompletion to consume the text from left to right and use a state machine to suggest cols or tables instead of relying on hacks.
* [ ] Add a few more special commands. (\l pattern, \dp, \ds, \dy, \z etc)
* [ ] Refactor pgspecial.py to a class. 
* [ ] Show/hide docs for a statement using a keybinding.
* [ ] Check how to add the name of the table before printing the table.
* [ ] Add a new trigger for M-/ that does naive completion.
* [ ] New Feature List - Write the current version to config file. At launch if the version has changed, display the changelog between the two versions.
* [ ] Add a test for 'select * from custom.abc where custom.abc.' should suggest columns from abc.
* [ ] pgexecute columns(), tables() etc can be just cursors instead of fetchall()
* [ ] Add colorschemes in config file.
* [X] \np autocomplete not working. - v4.3.17
* [X] Support \restrict/\unrestrict commands (CVE-2025-8714) - v4.3.17
      - Commands added in PostgreSQL 17.6/16.10/15.14+ (August 2025)
      - pg_dump emits \restrict <token> at start and \unrestrict <token> at end
      - Current implementation: recognizes commands and tracks token
      - TODO: Block meta-commands during restricted mode
        - Requires modifying pgexecute.py run() to check self.restrict_token
        - If restrict_token != None, only allow \unrestrict with correct token
        - Other meta-commands should be ignored or raise error
      - TODO: PR to dbcli/pgcli (not implemented upstream yet)
* [ ] pgcli_isready: pg_isready wrapper with SSH tunnel support
* [X] Security: Sanitize SSH passwords from debug logs - v4.3.18
* [X] Security: Mask passwords in --list-dsn output - v4.3.18
* [ ] Security: Evaluate sshtunnel alternatives (unmaintained, incompatible with paramiko 4.x)
      - sshtunnel 0.4.0 has no releases in 12+ months
      - paramiko 4.0 removed DSSKey, sshtunnel crashes on import
      - Options: fork sshtunnel, find alternative, or monkey-patch
* [ ] Security: Configure explicit SSH host key verification policy
      - sshtunnel may default to AutoAddPolicy (accepts any host key)
      - Vulnerable to MITM attacks on SSH tunnels
* [X] Security: Use re.fullmatch() for SSH tunnel regex matching - v4.3.18
      - Currently re.search() can match partial hostnames (e.g. "prod" matches "nonprod")
* [X] Security: \i command opens user-specified file paths without sanitization - v4.3.18
      - main.py:570 - os.path.expanduser(pattern) with no validation
      - Low practical risk (user already has shell access), but could sanitize
* [X] Security: \o and \log-file write to user-specified paths without sanitization - v4.3.18
      - main.py:619-634 - opens arbitrary paths for writing
      - Same consideration as \i
* [X] Security: SQL statements with passwords may be logged - v4.3.18
      - pgexecute.py:439 - CREATE USER/ALTER USER with PASSWORD gets logged at DEBUG
      - Could detect and redact password clauses before logging
